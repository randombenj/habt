#!/bin/sh

# prepare tests by running the importer
# docker exec -it habt_web_1 python habt

# source:
#  http://stackoverflow.com/a/35218558
#  http://stackoverflow.com/a/25042323

# start the tests
# start the webdriver
./node_modules/protractor/bin/webdriver-manager update > /dev/null 2>&1
./node_modules/protractor/bin/webdriver-manager start > /dev/null 2>&1 &

# wait for port 4444 to listen for connections
while ! nc -z 127.0.0.1 4444; do sleep 1; done

# execute e2e tests
protractor tests/e2e/protractor.config.js

# terminate the webdriver (listening on port 4444)
fuser -k -n tcp 4444
